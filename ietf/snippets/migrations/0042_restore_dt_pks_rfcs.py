# -*- coding: utf-8 -*-
# Generated by Django 1.11.25 on 2020-03-31 19:54
from __future__ import unicode_literals

from django.db import migrations

dt_pks = {
     '3935': 3147,
     '3933': 3137,
     '3683': 2852,
     '8366': 9397,
     '2438': 1181,
     '5377': 3839,
     '8174': 8759,
     '3710': 2740,
     '7418': 3,
     '3692': 2270,
     '5234': 4183,
     '7129': 7111,
     '8224': 8906,
     '8555': 9554,
     '7450': 2153,
     '4371': 3635,
     '7127': 7282,
     '2850': 1649,
     '4879': 4026,
     '6840': 3542,
     '2181': 730,
     '3967': 3034,
     '7049': 7253,
     '2914': 1695,
     '6771': 4995,
     '5434': 3703,
     '3596': 2648,
     '8484': 9498,
     '5155': 3437,
     '4033': 2271,
     '8499': 9526,
     '3233': 1639,
     '6220': 2748,
     '5743': 3828,
     '6733': 4083,
     '5485': 4361,
     '4858': 3277,
     '4343': 2771,
     '1034': 6521,
     '1035': 9206,
     '2131': 494,
     '8415': 9514,
     '7120': 7198,
     '4474': 2718,
     '5111': 4240,
     '4633': 3771,
     '5657': 4513,
     '2360': 838,
     '4691': 3690,
     '4181': 2777,
     '6087': 4748,
     '5706': 4278,
     '5406': 2698,
     '3552': 2619,
     '5226': 3286,
     '8126': 8371,
     '3470': 2509,
     '4897': 3850,
     '7221': 7175,
     '8719': 9731,
     '4052': 3070,
     '8318': 8892,
     '7437': 7405,
     '2780': 1615,
     '5237': 4301,
     '5742': 4512,
     '7776': 8464,
     '3005': 1543,
     '7154': 7287,
     '3677': 2769,
     '8718': 9730,
     '2277': 1072,
     '3978': 3249,
     '2418': 985,
     '2031': 696,
     '8474': 9482,
     '2663': 1346,
     '6576': 5073,
     '3849': 2790,
     '2014': 799,
     '6740': 5512,
     '7942': 8739,
     '7475': 7411,
     '4846': 4157,
     '8179': 8365,
     '3979': 6976,
     '4443': 1592,
     '5322': 3935,
     '8200': 8818,
     '2812': 1577,
     '4949': 3302,
     '1983': 731,
     '8576': 9587,
     '1311': 130,
     '2119': 835,
     '8520': 9558,
     '2860': 1815,
     '8342': 9366,
     '3260': 1662,
     '7282': 7149,
     '6748': 5515,
     '8225': 8911,
     '4821': 3040,
     '8201': 8832,
     '8588': 9606,
     '3454': 2332,
     '7500': 7416,
     '6973': 5448,
     '4053': 3134,
     '4775': 3927,
     '5745': 4901,
     '5744': 4849,
     '4845': 4097,
     '6702': 5381,
     '4035': 2706,
     '3797': 2272,
     '6722': 7070,
     '4748': 3966,
     '4841': 4104,
     '6635': 5272,
     '5741': 4479,
     '7322': 7380,
     '2309': 997,
     '6410': 5051,
     '2865': 1509,
     '1122': 8204,
     '2606': 1087,
     '5378': 4149,
     '3261': 1889,
     '6701': 5523,
     '8226': 8907,
     '1982': 722,
     '3330': 2466,
     '7858': 8675,
     '4071': 3387,
     '5681': 3774,
     '6365': 5327,
     '7228': 7206,
     '4084': 3176,
     '4333': 3450,
     '3688': 2036,
     '2026': 629,
     '7649': 7531,
     '2028': 666,
     '4844': 3893,
     '8446': 9450,
     '7170': 5332,
     '3629': 2515,
     '5704': 4776,
     '3934': 3140,
     '8067': 8758,
     '7691': 7540,
     '5218': 4310,
     '2629': 1478,
     '8519': 9557
}

snippets_pks = {
     '3935': 58,
     '3933': 56,
     '3683': 51,
     '8366': 143,
     '2438': 17,
     '5377': 74,
     '8174': 134,
     '3710': 45,
     '7418': 1,
     '3692': 33,
     '5234': 86,
     '7129': 113,
     '8224': 138,
     '8555': 149,
     '7450': 32,
     '4371': 68,
     '7127': 119,
     '2850': 26,
     '4879': 80,
     '6840': 67,
     '2181': 8,
     '3967': 52,
     '7049': 118,
     '2914': 28,
     '6771': 99,
     '5434': 70,
     '3596': 41,
     '8484': 146,
     '5155': 65,
     '4033': 34,
     '8499': 148,
     '3233': 25,
     '6220': 46,
     '5743': 73,
     '6733': 81,
     '5485': 91,
     '4858': 61,
     '4343': 48,
     '1034': 110,
     '1035': 141,
     '2131': 3,
     '8415': 147,
     '7120': 116,
     '4474': 44,
     '5111': 87,
     '4633': 71,
     '5657': 94,
     '2360': 12,
     '4691': 69,
     '4181': 49,
     '6087': 95,
     '5706': 88,
     '5406': 42,
     '3552': 40,
     '8126': 129,
     '5226': 62,
     '3470': 38,
     '4897': 75,
     '7221': 115,
     '8719': 155,
     '4052': 54,
     '8318': 137,
     '7437': 122,
     '2780': 24,
     '5237': 89,
     '5742': 93,
     '7776': 130,
     '3005': 21,
     '7154': 120,
     '3677': 47,
     '2277': 15,
     '3978': 60,
     '2418': 13,
     '2031': 6,
     '8474': 145,
     '2663': 18,
     '6576': 101,
     '3849': 50,
     '2014': 10,
     '6740': 107,
     '7942': 132,
     '7475': 123,
     '4846': 85,
     '8179': 128,
     '3979': 111,
     '4443': 23,
     '5322': 78,
     '8200': 135,
     '2812': 22,
     '4949': 63,
     '1983': 9,
     '8576': 152,
     '1311': 2,
     '2119': 11,
     '8520': 151,
     '2860': 29,
     '8342': 142,
     '3260': 27,
     '7282': 114,
     '6748': 108,
     '8225': 140,
     '4821': 53,
     '8201': 136,
     '8588': 153,
     '3454': 36,
     '7500': 124,
     '6973': 106,
     '4053': 55,
     '4775': 77,
     '5745': 98,
     '5744': 97,
     '4845': 82,
     '6702': 105,
     '4035': 43,
     '3797': 35,
     '6722': 112,
     '4748': 79,
     '4841': 83,
     '8718': 154,
     '6635': 102,
     '5741': 92,
     '7322': 121,
     '2309': 14,
     '6410': 100,
     '2865': 20,
     '1122': 127,
     '2606': 16,
     '5378': 84,
     '3261': 30,
     '6701': 109,
     '8226': 139,
     '1982': 7,
     '3330': 37,
     '7858': 131,
     '4071': 64,
     '5681': 72,
     '6365': 103,
     '7228': 117,
     '4084': 59,
     '4333': 66,
     '3688': 31,
     '2026': 4,
     '7649': 125,
     '2028': 5,
     '4844': 76,
     '8446': 144,
     '7170': 104,
     '3629': 39,
     '5704': 96,
     '3934': 57,
     '8067': 133,
     '7691': 126,
     '5218': 90,
     '2629': 19,
     '8519': 150
}

def forward(apps, schema_editor):

    HomePage = apps.get_model('home','HomePage')
    hp = HomePage.objects.first()
    highlighted_rfc = hp.highlighted_request_for_comment.rfc
    hp.highlighted_request_for_comment = None
    hp.save()

    RFC = apps.get_model('snippets','RFC')
    actual_snippets_pks = dict(RFC.objects.values_list('rfc','pk'))
    assert(snippets_pks == actual_snippets_pks)
    assert(set(dt_pks.values()).intersection(set(snippets_pks.values())) == set([3,130]))
    max_pk = max(dt_pks.values())
    RFC.objects.filter(id=3).update(id=max_pk+1)
    RFC.objects.filter(id=130).update(id=max_pk+2)
    snippets_pks[RFC.objects.get(id=max_pk+1).rfc]=max_pk+1
    snippets_pks[RFC.objects.get(id=max_pk+2).rfc]=max_pk+2

    for rfc, dt_pk in dt_pks.items():
        RFC.objects.filter(id=snippets_pks[rfc]).update(id=dt_pk)

    actual_snippets_pks = dict(RFC.objects.values_list('rfc','pk'))
    assert(dt_pks == actual_snippets_pks)

    hp.highlighted_request_for_comment_id = dt_pks[highlighted_rfc]
    hp.save()


def reverse(apps, schema_editor):

    HomePage = apps.get_model('home','HomePage')
    hp = HomePage.objects.first()
    highlighted_rfc = hp.highlighted_request_for_comment.rfc
    hp.highlighted_request_for_comment = None
    hp.save()

    RFC = apps.get_model('snippets','RFC')
    actual_snippets_pks = dict(RFC.objects.values_list('rfc','pk'))
    assert(dt_pks == actual_snippets_pks)
    max_pk = max(dt_pks.values())
    RFC.objects.filter(id=3).update(id=max_pk+1)
    RFC.objects.filter(id=130).update(id=max_pk+2)
    dt_pks[RFC.objects.get(id=max_pk+1).rfc]=max_pk+1
    dt_pks[RFC.objects.get(id=max_pk+2).rfc]=max_pk+2

    for rfc, snippets_pk in snippets_pks.items():
        RFC.objects.filter(id=dt_pks[rfc]).update(id=snippets_pk)

    actual_snippets_pks = dict(RFC.objects.values_list('rfc','pk'))
    assert(snippets_pks == actual_snippets_pks)

    hp.highlighted_request_for_commnet_id = snippets_pks[highlighted_rfc]
    hp.save()

class Migration(migrations.Migration):

    dependencies = [
        ('snippets', '0041_rename_mailinglistsignup_snippets_working_group'),
        ('home', '0011_remove_highlighted_internet_draft'),
    ]

    operations = [
        migrations.RunPython(forward,reverse)
    ]